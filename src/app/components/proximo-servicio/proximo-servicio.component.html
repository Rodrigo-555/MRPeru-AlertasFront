<div class="main-container">
  <div class="content">
    <h1>PRÓXIMO SERVICIO</h1>

    <!-- Filtros -->
    <section class="filtros-servicio">
      <div class="search-container">
        <div class="form-group">
          <label for="fechaInicio">Desde:</label>
          <input
            id="fechaInicio"
            type="date"
            class="form-control"
            [(ngModel)]="fechaInicio"
            (change)="filtrarPorFechas()">
        
          <label for="fechaFin">Hasta:</label>
          <input
            id="fechaFin"
            type="date"
            class="form-control"
            [(ngModel)]="fechaFin"
            (change)="filtrarPorFechas()">
        
          <button class="btn btn-primary mt-2" type="button" (click)="filtrarPorFechas()">Filtrar</button>
        </div>

        <div class="filtro mb-3">
          <label for="categoriaCliente">Categoría Clientes:</label>
          <select id="categoriaCliente" [(ngModel)]="categoriaClienteSeleccionada" (change)="filtrarEquipos()" class="form-control">
            <option [ngValue]="null" disabled selected>Seleccione una categoría</option>
            <option value="Clientes con Servicios Regulares">Clientes con Servicios Regulares</option>
            <option value="Clientes con Servicios No-Regulares">Clientes con Servicios No-Regulares</option>
            <option value="Clientes con Servicios Antiguos-Recientes">Clientes con Servicios Antiguos-Recientes</option>
            <option value="Clientes con Servicios Antiguos">Clientes con Servicios Antiguos</option>
            <option value="Clientes sin servicios">Clientes sin servicios</option>
            <option value="No Es Cliente">No Es Cliente</option>
          </select>
        </div>

        <div class="search-group">
          <img src="assets/img/iconoSearch.png" alt="Buscar" class="input-search-icon">
          <input 
            type="text" 
            class="form-control custom-search" 
            placeholder="Busque por cliente, referencia, local o serie"
            [(ngModel)]="busquedaTexto"
            (input)="filtrarPorTexto()">
        </div>
      </div>
    </section>

    <!-- Tabla de Equipos -->
    <section class="table-container">
      <table class="table" *ngIf="equiposFiltrados.length > 0; else emptyTable">
        <thead>
          <tr>
            <th (click)="ordenarPor('Cliente')">
              Cliente <i class="sort-icon" [ngClass]="getSortIcon('Cliente')"></i>
            </th>
            <th (click)="ordenarPor('Local')">
              Local <i class="sort-icon" [ngClass]="getSortIcon('Local')"></i>
            </th>
            <th (click)="ordenarPor('referencia')">
              Referencia <i class="sort-icon" [ngClass]="getSortIcon('referencia')"></i>
            </th>
            <th (click)="ordenarPor('serie')">
              Serie <i class="sort-icon" [ngClass]="getSortIcon('serie')"></i>
            </th>
            <th (click)="ordenarPor('estado')">
              Estado <i class="sort-icon" [ngClass]="getSortIcon('estado')"></i>
            </th>
            <th (click)="ordenarPor('estadoMantenimiento')">
              Estado Mantenimiento <i class="sort-icon" [ngClass]="getSortIcon('estadoMantenimiento')"></i>
            </th>
            <th (click)="ordenarPor('fechaProximoServicio')">
              Fecha Proximo Servicio <i class="sort-icon" [ngClass]="getSortIcon('fechaProximoServicio')"></i>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let equipo of equiposFiltrados | slice:(paginaActual-1)*itemsPorPagina:paginaActual*itemsPorPagina; trackBy: trackByEquipo">
            <td>{{ equipo.cliente }}</td>
            <td>{{ equipo.planta }}</td>
            <td>{{ equipo.referencia }}</td>
            <td>{{ equipo.serie }}</td>
            <td>
              <span class="estado-badge" [ngClass]="getBadgeClass(equipo.estado)">
                {{ getEstadoLabel(equipo.estado) }}
              </span>
            </td>
            <td>
              <span class="mantenimiento-badge" [ngClass]="getMantenimientoBadgeClass(equipo.estadoMantenimiento)">
                {{ getMantenimientoLabel(equipo.estadoMantenimiento) }}
              </span>
            </td>
            <td [class.proxima-fecha]="esFechaProxima(equipo.fechaProximoServicio)">
              {{ equipo.fechaProximoServicio | date: 'dd/MM/yyyy' }}
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Mensaje si no hay datos -->
      <ng-template #emptyTable>
        <div class="empty-table">
          <p>Seleccione una Categoria de Clientes.</p>
        </div>
      </ng-template>

      <!-- Paginación -->
      <nav class="pagination" *ngIf="equiposFiltrados.length > itemsPorPagina">
        <button class="page-button" [disabled]="paginaActual === 1" (click)="cambiarPagina(1)">«</button>
        <button class="page-button" [disabled]="paginaActual === 1" (click)="cambiarPagina(paginaActual - 1)">‹</button>
        <button 
          class="page-button" 
          *ngFor="let pagina of getPaginas()" 
          [class.active]="pagina === paginaActual"
          (click)="cambiarPagina(pagina)">
          {{ pagina }}
        </button>
        <button class="page-button" [disabled]="paginaActual === totalPaginas" (click)="cambiarPagina(paginaActual + 1)">›</button>
        <button class="page-button" [disabled]="paginaActual === totalPaginas" (click)="cambiarPagina(totalPaginas)">»</button>
      </nav>
    </section>
  </div>
</div>
